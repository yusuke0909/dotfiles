#+----------------------------------------------------------------------------------------+
#  Prefix Key
#+----------------------------------------------------------------------------------------+
# プレフィックスキーを設定
set-option -g prefix C-t
unbind-key C-b
bind-key C-t send-prefix

#+----------------------------------------------------------------------------------------+
#  Session Options
#+----------------------------------------------------------------------------------------+
# 新しいウィンドウ/ペインのベース番号
set-option -g base-index 0
set-option -g pane-base-index 1

# 全てのベルを無視
set-option -g bell-action none

# 各セッションで保持するバッファ数
set-option -g buffer-limit 32

# 256色端末を使用
## Mac
set-option -g default-terminal "screen-256color"
## Linux
# set-option -g default-terminal "xterm-256color"

# ウィンドウ履歴で保持される最大行数
set-option -g history-limit 10000

# ウィンドウ名の変更回避
set-option -g allow-rename off

# Escapeキー入力時の待ち時間(0.5秒)をキャンセル
set-option -s escape-time 0

# mouse設定
setw -g mouse on

# 右クリックメニュー
bind-key    -T root         MouseDown3Pane       if-shell -F -t = "#{||:#{mouse_any_flag},#{&&:#{pane_in_mode},#{?#{m/r:(copy|view)-mode,#{pane_mode}},0,1}}}" "select-pane -t= ; send -M" "display-menu -t= -xM -yM -T \"#[align=centre]#{pane_index} (#{pane_id})\" \
\"#{?#{m/r:(copy|view)-mode,#{pane_mode}},一番上に移動する,}\" < \"send -X history-top\" \
\"#{?#{m/r:(copy|view)-mode,#{pane_mode}},一番下に移動する,}\" > \"send -X history-bottom\" \
'' \
\"#{?mouse_word,#[underscore]#{=/9/...:mouse_word}#[none]を検索する,}\" C-r \"if -F \\\"#{?#{m/r:(copy|view)-mode,#{pane_mode}},0,1}\\\" \\\"copy-mode -t=\\\" ; send -Xt= search-backward \\\"#{q:mouse_word}\\\"\" \
\"#{?mouse_word,#[underscore]#{=/9/...:mouse_word}#[none]と入力する,}\" C-y \"copy-mode -q ; send-keys -l -- \\\"#{q:mouse_word}\\\"\" \
\"#{?mouse_word,#[underscore]#{=/9/...:mouse_word}#[none]をコピーする,}\" c \"copy-mode -q ; set-buffer -- \\\"#{q:mouse_word}\\\"\" \
\"#{?mouse_line,1行コピーする,}\" l \"copy-mode -q ; set-buffer -- \\\"#{q:mouse_line}\\\"\" \
'' \
\"🍻ペインを横に増やす\" h \"split-window -h\" \
\"🍣ペインを縦に増やす\" v \"split-window -v\" \
'' \
\"#{?#{>:#{window_panes},1},,-}👆ペインを上と交換する\" u \"swap-pane -U\" \
\"#{?#{>:#{window_panes},1},,-}👇ペインを下と交換する\" d \"swap-pane -D\" \
\"#{?pane_marked_set,,-}✅マーク付きペインと入れ替える\" s swap-pane \
'' \
❌ペインを閉じる X kill-pane \
📖ペインを初期化する R \"respawn-pane -k\" \
\"#{?pane_marked,🟩マークを外す,✅マークを付ける}\" m \"select-pane -m\" \
\"#{?#{>:#{window_panes},1},,-}#{?window_zoomed_flag,🌱最大化を解除する,🌳最大化する}\" z \"resize-pane -Z\""


#+----------------------------------------------------------------------------------------+
#  Status Line
#+----------------------------------------------------------------------------------------+
set-option -g status on

set -g status-left '#[fg=colour254,bg=colour180,bold] #(hostname -s)#[deafult] #S #[fg=colour180,bg=colour238,nobold]⮀#[fg=colour215,bg=colour238,bold] #(whoami)#[fg=colour238,bg=colour248]⮀'
set -g status-right '#[fg=colour131,bg=colour248,nobold]⮂#[fg=white,bg=colour131]#H ⮃ #I:#P #[fg=colour221,bg=colour131,nobold]⮂#[fg=colour88,bg=colour221] Mem #(used-mem)%% ⮃ LAve.[#(loadaverage)] #[fg=colour255,bg=colour221,bold]⮂#[fg=colour31,bg=colour255,bold] %Y/%m/%d(%a)%H:%M#[default]'

set-window-option -g window-status-format "#[fg=colour234, bg=colour248] #I: #W "
set-window-option -g window-status-current-format "#[fg=colour248, bg=colour124]⮀#[fg=colour255, bg=colour124] #I ⮁ #W #[fg=colour124, bg=colour248]⮀"

# set -g message-attr bold
# set -g message-fg white
# set -g message-bg red

# ステータスライン更新間隔(秒)
set -g status-interval 1
# ステータスライン長さ:左側
set -g status-left-length 120
# ステータスライン長さ:右側
set -g status-right-length 120
# ステータスラインカスタム関連
set -g status-bg colour248
set -g status-fg white
# set -g status-attr dim
set -g status-left-length 32
set -g status-right-length 150
# ペインの区切り線のスタイル
set-option -g pane-border-style "fg=white,bg=black"
set-window-option -g pane-active-border-style "fg=red,bg=black"

#+----------------------------------------------------------------------------------------+
#  Window Options
#+----------------------------------------------------------------------------------------+
# ウィンドウを閉じた時にインデックス番号を詰める
set-option -g renumber-windows on
# ウィンドウ一覧
set -g mode-style fg=colour0,bg=colour215
# ウィンドウを実行コマンド名で自動リネーム
set-window-option -g automatic-rename on
# スクロールモード、コピーモード、選択モードで vi のキーバインドを使う
set-window-option -g mode-keys vi
# ウィンドウで動作があるとステータスラインでハイライト
set -g visual-activity on
set -g visual-bell on
setw -g monitor-activity on
# setw -g window-status-activity-attr italics,reverse
# タイトル表示設定
set-option -g set-titles on

#+----------------------------------------------------------------------------------------+
#  Bind Keys
#+----------------------------------------------------------------------------------------+
# C-Right,C-Leftでウィンドウ切り替え
# * Ctrl and arrow keys doesn't work in putty! What do I do?
# http://tmux.svn.sourceforge.net/viewvc/tmux/trunk/FAQ
set -g terminal-overrides "xterm*:kLFT5=\eOD:kRIT5=\eOC:kUP5=\eOA:kDN5=\eOB:smkx@:rmkx@:colors=256"
bind-key -n C-Right next-window
bind-key -n C-Left previous-window

# ウィンドウ移動
bind t last-window
bind C-t last-window
bind -r C-n next-window
bind -r C-p previous-window

# ウィンドウ選択画面
bind Space choose-tree

# 新ウィンドウ作成
bind c new-window -c "#{pane_current_path}"
bind C-c new-window

# 分割していたペインそれぞれをWindowに
bind b break-pane

# ペインの縦分割
bind h split-window -vc "#{pane_current_path}"

# ペインの横分割
bind v split-window -hc "#{pane_current_path}"

# ペイン移動
bind -r C-h select-pane -L
bind -r C-j select-pane -D
bind -r C-k select-pane -U
bind -r C-l select-pane -R

# ペイン削除
bind C-d kill-pane

# ペインリサイズ関連vi風
bind -r H resize-pane -L 6
bind -r J resize-pane -D 6
bind -r K resize-pane -U 6
bind -r L resize-pane -R 6
bind s swap-pane -U

# ペイン終了
#bind k kill-pane
bind k confirm-before -p "kill-pane ? (y/n)" kill-pane

# ウィンドウ終了
#bind K kill-window
bind K confirm-before -p "kill-window ? (y/n)" kill-window

# ペイン番号表示
bind i display-panes

# コピーモード
bind-key y copy-mode \; display "(Copy mode)"

# ペーストモード
bind p paste-buffer

# vでマーク開始
if-shell "test expr '$OSTYPE' : 'darwin.*' > /dev/null" "set-option -g default-command 'reattach-to-user-namespace -l zsh'"
bind-key -T copy-mode-vi v send-keys -X begin-selection

# yでヤンク + クリップボードへコピー
bind-key -T copy-mode-vi y send-keys -X copy-pipe-and-cancel "reattach-to-user-namespace pbcopy"
bind-key -T copy-mode-vi Enter send-keys -X copy-pipe-and-cancel "reattach-to-user-namespace pbcopy"

# 複数ペインへの同時入力 
set-option -g synchronize-panes off
bind-key e set-window-option synchronize-panes on \; set-option -g status-bg colour172 \; display 'Synchronize begin'
bind-key E set-window-option synchronize-panes off \; set-option -g status-bg black \; display 'Synchronize end'

# manを新規ペインで開き、終了する際にペインを閉じる
bind-key m command-prompt "split-window -p 65 'exec man %%'"

# ssh接続時に新規ウィンドウ/ペインで開く
unbind s

# 新しいウィンドウ
bind-key s command-prompt "new-window -n %1 'TERM=xterm-256color sshrc -A %1'"

# ペイン縦分割で開く
bind-key S command-prompt "split-window -h 'TERM=xterm-256color sshrc -A %1'"

# ペイン横分割で開く
bind-key T command-prompt "split-window 'TERM=xterm-256color sshrc -A %1'"

# ペインを再起動(配置とディレクトリを維持)
bind q confirm-before -p "respawn-pane? (y/others)" "respawn-pane -k -c '#{pane_current_path}'"


# 設定リロード
bind r source-file ~/.tmux.conf ; display-message "Reload Config!!"

#+----------------------------------------------------------------------------------------+
#  tmux plugins
#+----------------------------------------------------------------------------------------+
# Tmux Plugin Manager(TPM):  git clone https://github.com/tmux-plugins/tpm ~/.tmux/plugins/tpm

# List of plugins
set -g @plugin 'tmux-plugins/tpm'

set -g @plugin 'tmux-plugins/tmux-sensible'
set -g @plugin 'tmux-plugins/tmux-resurrect'

set -g @plugin 'tmux-plugins/tmux-continuum'
set -g @continuum-save-interval '60'
set -g @continuum-restore 'on'

# Initialize TMUX plugin manager (keep this line at the very bottom of tmux.conf)
run '~/.tmux/plugins/tpm/tpm'


